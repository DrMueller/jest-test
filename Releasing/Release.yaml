name: 1.1$(rev:.r) # build numbering format

resources:
  pipelines:
  - pipeline: release-pip # Name of the pipeline resource
    source: 01-JestTest-Continuous-Integration # Name of the pipeline referenced by the pipeline resource
    trigger: 
      branches:
      - refs/heads/master^

variables:
- name: temp
  value: 1
  ${{ if endsWith( variables['Build.SourceBranchName'], 'master' ) }}: 
    - name: appVersion
      value: $(Build.BuildNumber)
  ${{ else }}: 
    - name: appVersion
      value: format('{0}{1}', "$(Build.BuildNumber)", ´-beta´])

pool:
  name: Azure Pipelines
  vmImage: "windows-latest"
  demands: npm

steps:
  - task: Npm@1
    displayName: "NPM CI"
    inputs:
      command: custom
      verbose: false
      customCommand: ci

  - task: Npm@1
    displayName: "Git Clean"
    inputs:
      command: custom
      verbose: false
      customCommand: "run ci:git-clean"

  - task: Npm@1
    displayName: "Git Config"
    inputs:
      command: custom
      verbose: false
      customCommand: "run ci:git-config"

  - task: Npm@1
    displayName: "Update version"
    inputs:
      command: custom
      verbose: false
      customCommand: "version $(appVersion)"

  - task: Npm@1
    displayName: "Publish"
    inputs:
      command: custom
      verbose: false
      customCommand: "run ci:vsce-publish -- -p $(VscePublishToken)"
